# AutoDocGen Web Platform - Requirements Document

將現有的 Python CLI 文件生成工具重構為 Web 平台,支援多用戶、模板管理、狀態追蹤,並部署到 Firebase。核心功能包括:專案管理、一對多文件生成、模板動態變數配置、狀態流程管理、權限控制。

## Core Features

### 1. 專案管理系統
- 建立、編輯、刪除專案
- 專案包含基本資料:專案名稱、公司、聯絡人、金額、日期
- 支援狀態管理:草稿(draft)、製作中(in_progress)、暫停中(paused)、待請款(pending_invoice)、待發款(pending_payment)、已完成(completed)
- 記錄狀態變更歷史(時間戳 + 操作者)
- 專案列表支援篩選、排序、搜尋

### 2. 模板管理系統
- 上傳 Word 文件模板(.docx)
- 自動掃描模板中的變數佔位符({{variable_name}})
- 區分標準變數和自訂變數
- 標準變數清單:project_name, company_name, company_head, taxID, company_address, contacts, price, untaxed, taxes, date, contact_date, code, now_year, now_month, now_day
- 自訂變數支援 Regex 推斷配置(欄位名稱、資料類型、必填)
- 支援模板版本管理
- 可啟用/停用模板

### 3. 一對多文件生成
- 建立專案時可勾選多個模板
- 根據選擇的模板動態顯示額外欄位表單
- 一次生成所有選中的模板文件
- 支援事後補生成文件
- 支援重新生成已存在的文件
- 文件儲存於 Firebase Storage
- 記錄每個生成文件的元資料(生成時間、檔案大小、使用的資料)

### 4. 公司與聯絡人管理
- 管理公司資料:公司名稱、統編、負責人、地址
- 管理聯絡人資料:姓名、電話、Email
- 專案建立時可選擇現有公司/聯絡人或新增

### 5. 文件編號自動生成
- 沿用現有編號規則:HIYES{年2碼}{月字母}{日字母2碼}{流水號3碼}
- 同日期自動遞增流水號

### 6. 用戶權限管理
- Firebase Authentication 登入
- 支援權限控制:擁有者(owner)、成員(member)、訪客(viewer)
- 擁有者可開放權限給其他用戶
- 不同權限有不同操作限制

### 7. Dashboard 儀表板
- 參考 Google Analytics 風格設計
- 顯示專案總覽(各狀態數量)
- 最近活動紀錄
- 快速操作入口

## User Stories

### 專案管理
- **US-1**: 身為用戶,我想要在 Web 介面建立新專案,這樣我就不用每次都到專案目錄執行 Python 腳本
- **US-2**: 身為用戶,我想要看到所有專案的狀態,這樣我能快速知道哪些案子需要處理
- **US-3**: 身為用戶,我想要變更專案狀態並記錄時間戳,這樣我能追蹤每個案子的進度歷史
- **US-4**: 身為用戶,我想要篩選「待請款」狀態的專案,這樣我能快速準備請款資料

### 模板管理
- **US-5**: 身為用戶,我想要上傳新的 Word 模板,這樣我能支援不同格式的文件
- **US-6**: 身為用戶,當我上傳模板時系統自動分析需要哪些變數,這樣我不用手動整理變數清單
- **US-7**: 身為用戶,我想要為新變數定義欄位類型(文字/數字/日期/下拉選單),這樣建立專案時能有正確的表單輸入
- **US-8**: 身為用戶,我想要更新既有模板並保留版本紀錄,這樣我能追蹤模板的變更

### 文件生成
- **US-9**: 身為用戶,我想要同時勾選「報價單」和「合約」模板,一次生成兩份文件,這樣我不用分兩次操作
- **US-10**: 身為用戶,我想要在專案建立後補生成「驗收單」,這樣我能因應不同階段的需求
- **US-11**: 身為用戶,我想要下載已生成的文件,這樣我能寄給客戶或存檔
- **US-12**: 身為用戶,當資料有變更時我想要重新生成文件,這樣我能確保文件內容正確

### 公司與聯絡人管理
- **US-13**: 身為用戶,我想要管理公司資料庫,這樣建立專案時能快速選擇而不用重複輸入
- **US-14**: 身為用戶,我想要管理聯絡人資料庫,這樣能記錄每個窗口的聯絡方式

### 權限管理
- **US-15**: 身為擁有者,我想要邀請助理或會計使用系統,這樣他們能協助處理專案
- **US-16**: 身為擁有者,我想要設定不同用戶的權限,這樣能控制誰可以編輯或只能查看

### 資料遷移
- **US-17**: 身為用戶,我想要將現有 20 個月的歷史 projects.json 匯入新系統,這樣我不會遺失過去的資料

## Acceptance Criteria

### 專案管理 (AC-1)
- [ ] 可以建立專案並填寫基本資料(專案名稱、公司、聯絡人、金額、日期)
- [ ] 可以編輯專案資料
- [ ] 可以刪除專案(需二次確認)
- [ ] 可以變更專案狀態(6 個狀態之間切換)
- [ ] 狀態變更會記錄時間戳和操作者
- [ ] 專案列表顯示:專案名稱、公司、金額、狀態、最後更新時間
- [ ] 可以依狀態篩選專案
- [ ] 可以搜尋專案(依專案名稱或公司名稱)
- [ ] 可以依日期或金額排序

### 模板管理 (AC-2)
- [ ] 可以上傳 .docx 檔案作為模板
- [ ] 上傳後自動掃描 {{placeholder}} 格式的變數
- [ ] 區分標準變數和新變數
- [ ] 對於新變數,顯示系統建議的配置(基於 Regex 推斷)
- [ ] 用戶可以修改變數配置(欄位名稱、類型、選項、必填)
- [ ] 支援的變數類型:text, number, date, email, tel, select, textarea
- [ ] 可以啟用/停用模板
- [ ] 可以更新模板檔案,版本號自動遞增
- [ ] 模板列表顯示:名稱、類型、版本、變數數量、啟用狀態

### 文件生成 (AC-3)
- [ ] 建立專案時可勾選多個啟用的模板
- [ ] 根據選中的模板動態顯示額外欄位表單
- [ ] 必填欄位未填寫時無法提交
- [ ] 提交後自動生成所有選中模板的文件
- [ ] 生成成功後顯示下載連結
- [ ] 專案詳情頁列出所有已生成的文件
- [ ] 可以下載已生成的文件
- [ ] 可以刪除已生成的文件
- [ ] 可以補生成新的模板文件
- [ ] 可以重新生成已存在的文件(會刪除舊版本)
- [ ] 文件檔名格式:{專案名稱}_{模板名稱}.docx

### 公司與聯絡人管理 (AC-4)
- [ ] 可以新增、編輯、刪除公司
- [ ] 公司包含:公司名稱、統編、負責人、地址
- [ ] 可以新增、編輯、刪除聯絡人
- [ ] 聯絡人包含:姓名、電話、Email
- [ ] 建立專案時可從下拉選單選擇現有公司/聯絡人
- [ ] 建立專案時可直接新增公司/聯絡人

### 文件編號 (AC-5)
- [ ] 自動生成文件編號:HIYES{年2碼}{月字母}{日字母2碼}{流水號3碼}
- [ ] 年份使用西元年後2碼(如 2025 → 25)
- [ ] 月份使用字母(1月=A, 2月=B, ..., 12月=L)
- [ ] 日期使用雙字母(1日=AA, 2日=AB, ..., 26日=AZ, 27日=BA, ...)
- [ ] 同日期多個專案流水號自動遞增(001, 002, 003...)

### 用戶權限 (AC-6)
- [ ] 支援 Firebase Authentication 登入(Email/Password)
- [ ] 新用戶註冊後自動成為擁有者
- [ ] 擁有者可以邀請其他用戶(透過 Email)
- [ ] 支援三種權限:owner(所有權限)、member(可編輯)、viewer(僅查看)
- [ ] viewer 無法建立/編輯/刪除專案
- [ ] member 可以建立/編輯專案但無法刪除或管理權限
- [ ] owner 可以管理所有功能和用戶權限

### Dashboard (AC-7)
- [ ] 顯示各狀態專案數量(卡片式顯示)
- [ ] 顯示最近 10 筆活動紀錄(建立/編輯專案、生成文件)
- [ ] 顯示本月建立的專案數量和總金額
- [ ] 快速操作:新增專案、管理模板
- [ ] 響應式設計,支援手機、平板、桌面

### 資料遷移 (AC-8)
- [ ] 提供 migration script 匯入歷史 projects.json
- [ ] 自動匯入公司資料(從 config/companies.json)
- [ ] 自動匯入聯絡人資料(從 config/contacts.json)
- [ ] 匯入歷史文件的元資料(但不上傳實際檔案到 Storage)
- [ ] 匯入後資料完整性驗證

## Non-functional Requirements

### 效能要求
- 專案列表載入時間 < 2 秒(100 筆專案內)
- 文件生成時間 < 10 秒/檔(單一模板)
- 支援同時生成最多 5 個模板
- 上傳模板檔案大小限制:10 MB

### 安全性要求
- 所有 API 呼叫需驗證 Firebase Auth Token
- Firestore Security Rules 強制執行權限控制
- 敏感資料(統編)不記錄在日誌中
- 文件檔案僅限有權限的用戶下載(Storage Rules)

### 相容性要求
- 前端支援瀏覽器:Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- 支援 RWD 響應式設計(手機 375px+, 平板 768px+, 桌面 1024px+)
- 支援 Word 模板格式:.docx (Office 2007+)

### 可用性要求
- UI 參考 Google Analytics 風格:乾淨、簡潔、卡片式設計
- 表單驗證即時回饋
- 操作成功/失敗有明確提示訊息
- 重要操作(刪除)需二次確認

### 可維護性要求
- 前端與後端分離架構
- Cloud Functions 模組化(每個功能獨立 Function)
- 資料庫 Schema 有清楚的型別定義
- 關鍵邏輯有註解說明

### 部署要求
- 部署到 Firebase (Hosting + Functions + Firestore + Storage)
- 使用 Firebase CLI 進行部署
- 支援 staging 和 production 環境
- 提供部署腳本自動化流程

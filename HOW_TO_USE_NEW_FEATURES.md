# 🎉 新功能使用指南：公司与联系人管理

## ✅ 已完成的新功能

你现在拥有完整的公司和联系人管理界面！**不再需要手动在 Firestore Console 添加数据了！**

### 🆕 新增页面

1. **公司管理** (`/companies`)
   - 列表查看
   - 新增公司
   - 编辑公司
   - 删除公司（二次确认）

2. **联系人管理** (`/contacts`) - 增强版
   - 列表查看（带头像）
   - 新增联系人
   - 编辑联系人
   - 删除联系人（二次确认）
   - **头像上传功能** ✨
   - **LINE ID 字段** ✨
   - **备注字段** ✨

---

## 🚀 立即开始使用

### 步骤 1: 访问应用

```
https://autodocgen-prod.web.app
```

### 步骤 2: 创建第一个公司（1分钟）

1. 访问公司管理页面：
   ```
   https://autodocgen-prod.web.app/companies
   ```

2. 点击右上角 **"新增公司"** 按钮

3. 填写表单：
   - **公司名称*** （必填）：例如 `测试科技有限公司`
   - 统一编号：`12345678` （选填）
   - 联系电话：`02-2345-6789`
   - 电子邮箱：`info@test-tech.com`
   - 公司地址：`台北市信义区信义路五段7号`
   - 公司网站：`https://www.test-tech.com`
   - 备注：任何相关信息

4. 点击 **"保存"**

5. ✅ 完成！自动返回公司列表

### 步骤 3: 创建第一个联系人（2分钟）

1. 访问联系人管理页面：
   ```
   https://autodocgen-prod.web.app/contacts
   ```

2. 点击右上角 **"新增联系人"** 按钮

3. 填写表单：

   **头像上传**：
   - 点击头像区域的相机图标
   - 选择图片（支持 JPG, PNG，最大 2MB）
   - 自动显示预览

   **基本信息**：
   - **姓名*** （必填）：`张三`
   - **所属公司*** （必填）：选择刚创建的公司
   - 职位：`项目经理`

   **联系方式**：
   - 联系电话：`0912-345-678`
   - LINE ID：`zhang_line_123` ✨
   - 电子邮箱：`zhang.san@test-tech.com`

   **备注**：
   - 任何补充信息

4. 点击 **"保存"**

5. ✅ 完成！自动返回联系人列表，可以看到头像！

### 步骤 4: 创建项目（使用新数据）

1. 访问项目页面：
   ```
   https://autodocgen-prod.web.app/projects
   ```

2. 点击 **"New Project"**

3. 现在可以从下拉菜单选择：
   - 刚创建的公司
   - 刚创建的联系人

4. 创建项目完成！

---

## 📋 功能详解

### 🏢 公司管理

#### 公司列表页面

**功能**：
- ✅ 卡片式布局，清晰展示所有公司
- ✅ 搜索功能：可搜索公司名称、邮箱、电话
- ✅ 统计卡片：
  - 总公司数
  - 有邮箱的公司数
  - 有电话的公司数

**操作**：
- **编辑**：点击公司卡片的 "编辑" 按钮
- **删除**：点击 "删除" → 再点一次 "确认删除"（防止误删）

#### 公司表单页面

**字段说明**：

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 公司名称 | 文本 | ✅ | 公司全称 |
| 统一编号 | 文本 | ❌ | 8位数字 |
| 联系电话 | 电话 | ❌ | 例如: 02-1234-5678 |
| 电子邮箱 | 邮箱 | ❌ | 自动验证格式 |
| 公司地址 | 文本 | ❌ | 完整地址 |
| 公司网站 | URL | ❌ | 例如: https://www.company.com |
| 备注 | 多行文本 | ❌ | 其他相关信息 |

**验证规则**：
- 公司名称：必填
- 邮箱：自动验证格式（必须包含 @ 和 .）
- 所有数据自动保存时间戳

---

### 👤 联系人管理（增强版）

#### 联系人列表页面

**功能**：
- ✅ 卡片式布局，带头像显示
- ✅ 搜索功能：可搜索姓名、公司、邮箱、电话、LINE ID
- ✅ 统计卡片：
  - 总联系人数
  - 有邮箱的联系人数
  - 有电话的联系人数
  - 有 LINE 的联系人数 ✨

**卡片信息显示**：
- 头像（如果已上传）
- 姓名 + 职位
- 所属公司（自动显示公司名称）
- 联系电话
- 电子邮箱
- LINE ID ✨
- 备注（最多显示 2 行）

#### 联系人表单页面

**字段说明**：

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| **头像** | 图片 | ❌ | 支持 JPG/PNG，最大 2MB ✨ |
| 姓名 | 文本 | ✅ | 联系人姓名 |
| 所属公司 | 下拉选择 | ✅ | 从公司列表选择 |
| 职位 | 文本 | ❌ | 例如: 项目经理 |
| 联系电话 | 电话 | ❌ | 例如: 0912-345-678 |
| **LINE ID** | 文本 | ❌ | LINE 账号 ✨ |
| 电子邮箱 | 邮箱 | ❌ | 自动验证格式 |
| **备注** | 多行文本 | ❌ | 补充信息 ✨ |

**头像上传功能** ✨：
1. 点击头像区域的相机图标
2. 选择图片文件
3. 自动显示预览
4. 保存时自动上传到 Firebase Storage
5. 生成唯一文件名（防止覆盖）

**验证规则**：
- 姓名：必填
- 所属公司：必填（必须先创建公司）
- 邮箱：自动验证格式
- 图片：
  - 大小限制：2MB
  - 格式限制：图片文件（JPG, PNG, GIF等）
  - 自动生成唯一文件名

---

## 🎯 使用场景示例

### 场景 1: 新客户入驻

1. **创建公司**（`/companies/new`）
   - 填写公司基本信息
   - 保存

2. **创建多个联系人**（`/contacts/new`）
   - 为该公司添加多个联系人
   - 上传头像
   - 记录 LINE ID（方便沟通）
   - 添加备注（如：负责人、决策者等）

3. **创建项目**（`/projects/new`）
   - 选择公司
   - 选择主要联系人
   - 完成项目创建

### 场景 2: 更新联系人信息

1. 访问联系人列表（`/contacts`）
2. 搜索联系人姓名
3. 点击 "编辑"
4. 更新信息（例如：更换头像、更新 LINE ID）
5. 保存

### 场景 3: 批量查看

1. **公司列表**：
   - 快速查看所有合作公司
   - 搜索特定公司
   - 查看完整联系方式

2. **联系人列表**：
   - 快速浏览所有联系人（带头像）
   - 搜索特定联系人
   - 查看所属公司
   - 一目了然的联系方式

---

## 💡 使用技巧

### 搜索技巧

**公司搜索**：
- 输入公司名称的任何部分
- 输入电话号码
- 输入邮箱

**联系人搜索**：
- 输入姓名
- 输入公司名称（会自动搜索）
- 输入电话
- 输入 LINE ID ✨
- 输入邮箱

### 头像上传技巧

1. **推荐尺寸**：正方形图片（例如: 400x400）
2. **文件大小**：建议 100KB - 500KB
3. **格式**：JPG 压缩率最好
4. **预处理**：可以先裁剪成圆形或正方形

### 数据管理技巧

1. **先创建公司，再创建联系人**
   - 联系人必须关联到公司
   - 建议先建立公司数据库

2. **善用备注字段**
   - 记录特殊偏好
   - 记录沟通注意事项
   - 记录重要日期

3. **删除前检查**
   - 删除公司前，确认没有关联的联系人
   - 删除联系人前，确认没有关联的项目

---

## 🔄 数据流程

```
创建公司
   ↓
创建联系人（选择公司）
   ↓
创建项目（选择公司和联系人）
   ↓
生成文档
```

---

## 📊 数据存储说明

### Firestore 结构

```
companies/
  ├── [company_id]/
  │   ├── company_name
  │   ├── tax_id
  │   ├── phone
  │   ├── email
  │   ├── address
  │   ├── website
  │   ├── notes
  │   ├── created_at
  │   └── updated_at

contacts/
  ├── [contact_id]/
  │   ├── contact_name
  │   ├── company_ref        // "companies/[company_id]"
  │   ├── position
  │   ├── phone
  │   ├── line_id           // ✨ 新增
  │   ├── email
  │   ├── avatar_url        // ✨ 新增
  │   ├── notes            // ✨ 新增
  │   ├── created_at
  │   └── updated_at
```

### Firebase Storage 结构

```
contacts/
  ├── [contact_id]_[timestamp]_[filename].jpg
  ├── [contact_id]_[timestamp]_[filename].png
  └── ...
```

**头像 URL 示例**：
```
https://firebasestorage.googleapis.com/v0/b/autodocgen-prod.appspot.com/o/contacts%2Fabc123_1698765432_avatar.jpg?alt=media&token=xyz...
```

---

## ⚠️ 注意事项

### 1. 删除操作

- 删除公司时，如果有关联的联系人，会提示错误
- 删除联系人时，如果有关联的项目，会提示错误
- 删除需要点击两次确认（防止误删）

### 2. 图片上传

- 上传的图片存储在 Firebase Storage
- 图片 URL 会自动保存到 Firestore
- 删除联系人时，图片不会自动删除（可以后续优化）

### 3. 数据关联

- 联系人的 `company_ref` 格式：`companies/[company_id]`
- 确保公司存在后再创建联系人
- 修改公司 ID 会导致关联失效

### 4. 性能考虑

- 头像文件限制 2MB（已实现）
- 建议压缩图片后上传
- 大量数据时使用搜索功能

---

## 🎉 总结

### 你现在可以：

✅ **通过 UI 管理公司**
- 不需要手动在 Firestore Console 添加
- 完整的 CRUD 操作
- 搜索和筛选

✅ **通过 UI 管理联系人**
- 不需要手动在 Firestore Console 添加
- 上传头像
- 添加 LINE ID
- 添加备注
- 完整的 CRUD 操作

✅ **快速创建项目**
- 从下拉菜单选择公司和联系人
- 数据自动关联
- 流程更顺畅

---

## 🚀 开始使用

```bash
# 1. 访问公司管理
open https://autodocgen-prod.web.app/companies

# 2. 访问联系人管理
open https://autodocgen-prod.web.app/contacts

# 3. 访问项目管理
open https://autodocgen-prod.web.app/projects
```

**现在就开始创建你的第一个公司和联系人吧！** 🎊

---

## 📞 功能建议

如果你想要更多功能，可以考虑：

### 短期
- [ ] 公司详情页（显示所有关联联系人）
- [ ] 联系人详情页（显示所有关联项目）
- [ ] 批量导入功能

### 中期
- [ ] 导出功能（CSV, Excel）
- [ ] 高级筛选（按公司、职位等）
- [ ] 标签系统

### 长期
- [ ] 联系人分组
- [ ] 沟通记录
- [ ] 生日提醒
- [ ] 自动备份

---

**祝你使用愉快！** 🎉
